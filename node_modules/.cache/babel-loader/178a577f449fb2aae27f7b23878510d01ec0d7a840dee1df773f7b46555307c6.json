{"ast":null,"code":"import{create}from'zustand';import CartService from'../services/cart.service';import useAuthStore from'./useAuthStore';const useCartStore=create((set,get)=>({items:[],subtotal:0,tax:0,total:0,isLoading:false,// Calculate totals\ncalculateTotals:()=>{const items=get().items;const subtotal=items.reduce((sum,item)=>sum+item.price*item.quantity,0);const tax=subtotal*0.08;// 8% tax\nconst total=subtotal+tax;set({subtotal,tax,total});},// Set cart\nsetCart:cart=>{const items=cart.items||[];const subtotal=cart.subtotal||items.reduce((sum,item)=>sum+item.price*item.quantity,0);const tax=cart.tax||subtotal*0.08;const total=cart.total||subtotal+tax;set({items,subtotal,tax,total});},// Fetch cart from server\nfetchCart:async()=>{const isAuthenticated=useAuthStore.getState().isAuthenticated;if(!isAuthenticated){const localCart=CartService.getLocalCart();console.log('Loading local cart:',localCart);get().setCart(localCart);return;}set({isLoading:true});try{const cart=await CartService.getCart();console.log('Fetched cart from server:',cart);get().setCart(cart);set({isLoading:false});}catch(error){var _error$response;set({isLoading:false});console.error('Failed to fetch cart:',error);console.error('Error details:',(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data);}},// Add to cart\naddToCart:async function(product){let quantity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;const isAuthenticated=useAuthStore.getState().isAuthenticated;if(!isAuthenticated){const cart=CartService.addToLocalCart(product,quantity);console.log('Added to local cart:',cart);get().setCart(cart);return;}set({isLoading:true});try{const cart=await CartService.addToCart(product._id,quantity);console.log('Added to cart response:',cart);get().setCart(cart);set({isLoading:false});}catch(error){set({isLoading:false});console.error('Add to cart error in store:',error);throw error;}},// Update cart item\nupdateCartItem:async(productId,quantity)=>{const isAuthenticated=useAuthStore.getState().isAuthenticated;if(!isAuthenticated){// Handle local cart update\nconst cart=CartService.getLocalCart();const itemIndex=cart.items.findIndex(item=>item.productId===productId);if(itemIndex>-1){cart.items[itemIndex].quantity=quantity;CartService.saveLocalCart(cart);get().setCart(cart);}return;}set({isLoading:true});try{const cart=await CartService.updateCartItem(productId,quantity);get().setCart(cart);set({isLoading:false});}catch(error){set({isLoading:false});throw error;}},// Remove from cart\nremoveFromCart:async productId=>{const isAuthenticated=useAuthStore.getState().isAuthenticated;if(!isAuthenticated){const cart=CartService.removeFromLocalCart(productId);get().setCart(cart);return;}set({isLoading:true});try{const cart=await CartService.removeFromCart(productId);get().setCart(cart);set({isLoading:false});}catch(error){set({isLoading:false});throw error;}},// Clear cart\nclearCart:async()=>{const isAuthenticated=useAuthStore.getState().isAuthenticated;if(!isAuthenticated){CartService.clearLocalCart();set({items:[],subtotal:0,tax:0,total:0});return;}set({isLoading:true});try{await CartService.clearCart();set({items:[],subtotal:0,tax:0,total:0,isLoading:false});}catch(error){set({isLoading:false});throw error;}},// Sync cart after login\nsyncCart:async()=>{const localCart=CartService.getLocalCart();if(localCart.items.length>0){try{const cart=await CartService.syncCart(localCart.items);get().setCart(cart);CartService.clearLocalCart();}catch(error){console.error('Failed to sync cart:',error);}}else{await get().fetchCart();}},// Get item count\ngetItemCount:()=>{return get().items.reduce((sum,item)=>sum+item.quantity,0);}}));export default useCartStore;","map":{"version":3,"names":["create","CartService","useAuthStore","useCartStore","set","get","items","subtotal","tax","total","isLoading","calculateTotals","reduce","sum","item","price","quantity","setCart","cart","fetchCart","isAuthenticated","getState","localCart","getLocalCart","console","log","getCart","error","_error$response","response","data","addToCart","product","arguments","length","undefined","addToLocalCart","_id","updateCartItem","productId","itemIndex","findIndex","saveLocalCart","removeFromCart","removeFromLocalCart","clearCart","clearLocalCart","syncCart","getItemCount"],"sources":["F:/projects/e-com/frontend/src/store/useCartStore.js"],"sourcesContent":["import { create } from 'zustand';\r\nimport CartService from '../services/cart.service';\r\nimport useAuthStore from './useAuthStore';\r\n\r\nconst useCartStore = create((set, get) => ({\r\n  items: [],\r\n  subtotal: 0,\r\n  tax: 0,\r\n  total: 0,\r\n  isLoading: false,\r\n\r\n  // Calculate totals\r\n  calculateTotals: () => {\r\n    const items = get().items;\r\n    const subtotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n    const tax = subtotal * 0.08; // 8% tax\r\n    const total = subtotal + tax;\r\n    set({ subtotal, tax, total });\r\n  },\r\n\r\n  // Set cart\r\n  setCart: (cart) => {\r\n    const items = cart.items || [];\r\n    const subtotal = cart.subtotal || items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n    const tax = cart.tax || subtotal * 0.08;\r\n    const total = cart.total || subtotal + tax;\r\n    \r\n    set({\r\n      items,\r\n      subtotal,\r\n      tax,\r\n      total\r\n    });\r\n  },\r\n\r\n  // Fetch cart from server\r\n  fetchCart: async () => {\r\n    const isAuthenticated = useAuthStore.getState().isAuthenticated;\r\n    if (!isAuthenticated) {\r\n      const localCart = CartService.getLocalCart();\r\n      console.log('Loading local cart:', localCart);\r\n      get().setCart(localCart);\r\n      return;\r\n    }\r\n\r\n    set({ isLoading: true });\r\n    try {\r\n      const cart = await CartService.getCart();\r\n      console.log('Fetched cart from server:', cart);\r\n      get().setCart(cart);\r\n      set({ isLoading: false });\r\n    } catch (error) {\r\n      set({ isLoading: false });\r\n      console.error('Failed to fetch cart:', error);\r\n      console.error('Error details:', error.response?.data);\r\n    }\r\n  },\r\n\r\n  // Add to cart\r\n  addToCart: async (product, quantity = 1) => {\r\n    const isAuthenticated = useAuthStore.getState().isAuthenticated;\r\n\r\n    if (!isAuthenticated) {\r\n      const cart = CartService.addToLocalCart(product, quantity);\r\n      console.log('Added to local cart:', cart);\r\n      get().setCart(cart);\r\n      return;\r\n    }\r\n\r\n    set({ isLoading: true });\r\n    try {\r\n      const cart = await CartService.addToCart(product._id, quantity);\r\n      console.log('Added to cart response:', cart);\r\n      get().setCart(cart);\r\n      set({ isLoading: false });\r\n    } catch (error) {\r\n      set({ isLoading: false });\r\n      console.error('Add to cart error in store:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Update cart item\r\n  updateCartItem: async (productId, quantity) => {\r\n    const isAuthenticated = useAuthStore.getState().isAuthenticated;\r\n\r\n    if (!isAuthenticated) {\r\n      // Handle local cart update\r\n      const cart = CartService.getLocalCart();\r\n      const itemIndex = cart.items.findIndex(item => item.productId === productId);\r\n      if (itemIndex > -1) {\r\n        cart.items[itemIndex].quantity = quantity;\r\n        CartService.saveLocalCart(cart);\r\n        get().setCart(cart);\r\n      }\r\n      return;\r\n    }\r\n\r\n    set({ isLoading: true });\r\n    try {\r\n      const cart = await CartService.updateCartItem(productId, quantity);\r\n      get().setCart(cart);\r\n      set({ isLoading: false });\r\n    } catch (error) {\r\n      set({ isLoading: false });\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Remove from cart\r\n  removeFromCart: async (productId) => {\r\n    const isAuthenticated = useAuthStore.getState().isAuthenticated;\r\n\r\n    if (!isAuthenticated) {\r\n      const cart = CartService.removeFromLocalCart(productId);\r\n      get().setCart(cart);\r\n      return;\r\n    }\r\n\r\n    set({ isLoading: true });\r\n    try {\r\n      const cart = await CartService.removeFromCart(productId);\r\n      get().setCart(cart);\r\n      set({ isLoading: false });\r\n    } catch (error) {\r\n      set({ isLoading: false });\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Clear cart\r\n  clearCart: async () => {\r\n    const isAuthenticated = useAuthStore.getState().isAuthenticated;\r\n\r\n    if (!isAuthenticated) {\r\n      CartService.clearLocalCart();\r\n      set({ items: [], subtotal: 0, tax: 0, total: 0 });\r\n      return;\r\n    }\r\n\r\n    set({ isLoading: true });\r\n    try {\r\n      await CartService.clearCart();\r\n      set({ items: [], subtotal: 0, tax: 0, total: 0, isLoading: false });\r\n    } catch (error) {\r\n      set({ isLoading: false });\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Sync cart after login\r\n  syncCart: async () => {\r\n    const localCart = CartService.getLocalCart();\r\n    if (localCart.items.length > 0) {\r\n      try {\r\n        const cart = await CartService.syncCart(localCart.items);\r\n        get().setCart(cart);\r\n        CartService.clearLocalCart();\r\n      } catch (error) {\r\n        console.error('Failed to sync cart:', error);\r\n      }\r\n    } else {\r\n      await get().fetchCart();\r\n    }\r\n  },\r\n\r\n  // Get item count\r\n  getItemCount: () => {\r\n    return get().items.reduce((sum, item) => sum + item.quantity, 0);\r\n  }\r\n}));\r\n\r\nexport default useCartStore;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}